# アクセスキー設定手順

AWS CLIをAWS環境以外から実行するため、AWS CLIのアクセスキーを設定する。

## 前提条件

- AWS CLIがインストール済であること
  [公式インストールガイド](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.htmlLinux：`Terminal`)
- IAMのアクセスキー操作権限が付与されていること

## 手順

1. アクセスキーの作成
    - AWS マネジメントコンソールにログイン
    - ナビゲーションバーから「IAM」を選択
    - 左メニューから「ユーザー」を選択し、対象のユーザーをクリック
    - 「セキュリティ認証情報」タブを開く
    - 「多要素認証 (MFA) 」セクションで「識別子」を控える
    - 「アクセスキー」セクションで「アクセスキーを作成」をクリック
    - 以下を設定して「次へ」をクリック
      - 「コマンドラインインターフェイス(CLI)」を選択
      - 「上記のレコメンデーションを理解し、アクセスキーを作成します。」をチェック
    - 「アクセスキーを作成」をクリック
    - 表示されたアクセスキーID とシークレットアクセスキーを控える
      - シークレットアクセスキーは一度しか表示されません
      - 「.csvファイルをダウンロード」からファイルを取得しておく

2. AWS CLIにアクセスキー情報を設定
    - `aws configure` コマンドを実行して、必要な項目を設定する。

      ```bash or powershell
      aws configure
      AWS Access Key ID [None]: [1.で取得したアクセスキー]
      AWS Secret Access Key [None]: [1.で取得したシークレットアクセスキー]
      Default region name [None]: ap-northeast-1
      Default output format [None]: json
      ```

3. AWS CLIに一時的な認証情報を設定
    - 以下のコマンドを実行して、一時的な認証情報を取得する。

      ```bash or powershell
      aws sts get-session-token --serial-number [1.で確認したMFA識別子] --token-code [MFAコード（6桁）]
      ※証明書エラーが出る場合は、--no-verify-ssl オプションを追加
      ```

    - 以下のコマンドを実行して、一時的な認証情報を設定する。

      ```bash or powershell
      aws configure set aws_access_key_id [3.で取得した一時的なAccessKeyId]
      aws configure set aws_secret_access_key [3.で取得した一時的なSecretAccessKey]
      aws configure set aws_session_token [3.で取得した一時的なSessionToken]
      ```

    - 以下のテストコマンドを実行して、AWS CLIが実行できることを確認する。

      ```bash or powershell
      aws s3 ls
      ※証明書エラーが出る場合は、--no-verify-ssl オプションを追加
      ```
