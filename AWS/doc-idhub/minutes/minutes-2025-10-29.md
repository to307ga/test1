# 2025-10-29

## 目次

- [1. 直近、やること](#1-直近やること)
  - [1.0. 今できること。 2026-10-29](#10-今できること-2026-10-29)
  - [1.0.1 今、やっていること](#101-今やっていること)
  - [1.1. 要件定義書 → 設計書作成 → Cfnテンプレート作成までの流れ](#11-要件定義書--設計書作成--cfnテンプレート作成までの流れ)
- [2. 必要なモノ・武器](#2-必要なモノ武器)
- [4. PoC環境での検証](#4-poc環境での検証)
  - [4.2. PoCでの検証項目を明確にしていきたいよね](#42-pocでの検証項目を明確にしていきたいよね)
  - [4.3 IaC の守備範囲](#43-iac-の守備範囲)
  - [4.5 Sceptre Templateで受け付けるParameter](#45-sceptre-templateで受け付けるparameter)
- [以降はアーカイブ](#以降はアーカイブ)
  - [1. Desktop](#1-desktop)
  - [2. コミュニケーション手段](#2-コミュニケーション手段)
- [3. 「idhub とは？」を知りたい](#3-idhub-とはを知りたい)
  - [4.1. オンプレからAWS PoC環境へデータ転送したい](#41-オンプレからaws-poc環境へデータ転送したい)

## 1. 直近、やること

- 他のSaaS（FutureVuls、Datadog）を使えるように申請（宮内）
  - AWSと並行して、単独でDatadog等の操作、調査ができるかもね。
  - Datadogは「試用期間」があっていろいろ触れる。
  - 優先度は強いて言うならDatadog。
  - （参考）DOCOMO社 推奨 SaaS、Agent
    - CrowdStrike ー 「振る舞い検知」
    - FutureVuls ー 脆弱性やEOL検知
    - DataDog ー 監視・メトリクス
  - FutureVuls Trial
    - 来週から使える。10/27ぐらい～
    - オンプレで、脆弱性やEOLの「ウミ」を出す。

### 1.0. 今できること。 2026-10-29

- Network → Batch
  - パラメータ設定する。たとえば、Network Firewall。
  - VPC、AZなど「外側」のネットワークのCfnによる構築。
- BatchのPython化、につなげる。
  - これに必要なのはAurora（DB）
  - SESは既に先行案件で完成してる。
- FutureVuls、オンプレにインストール
  - 脆弱性出たら、オンプレで解消させる。
  - 三鷹用 Playbookに定義してしまう。

### 1.0.1 今、やっていること

- 尾岸
  - Amazon Linux 2023 化になることによるパッケージの差異
    - Ansible Controler（EC2）でPlaybook Kickできるまでをゴールにする。
    - 将来的にはSSM経由でPlaybookをKickできるようにする。
    - (2026-10-29) 進捗
      - パッケージの調査
      - Playbookの書き換え
  - Jenkins on Fargate（10/29、やや優先度下げ。後回し）
- 斎藤
  - idhub-hlp構築
    - ここでの、パッケージ差分調査。
  - Jenkins on Fargate
    - Jenkinsインスタンスが起動したあと、動作確認＋設定。
- 中川
  - パラメータ定義書 - Done
  - Network構築（🎈）
    - DOCOMO -> CNS : 必要な情報（が分かる限り）渡します。
    - CNS -> DOCOMO ： 何が必要か、わかったら言ってください。
    - 「パラメータ定義書」の「根拠」欄も埋めながら。
    - `sceptre/config` ディレクトリ内のパラメータを設定していく。← Repository鍛えていく。
    - And、実際に `uv run sceptre create xxxx` してネットワーク構築していく。
    - `sceptre` に子慣れる。
      - 「構築しながら設計」ならば、`sceptre/config` ディレクトリを鍛えていく。
- 伊藤
  - `4. 非機能要件`, `5. 追加要件`（🎈）
- 今井
  - FutureVuls on-premise
    - Dev (Prodは伊藤恵吾)
  - Datadog、味見
    - 疑問：
      - ログ監視は「どこのログを」監視するの？
  - `3. セキュリティ要件` （🎈）
  - SSMでローカルからPlaybook Kickする。
    - EC2 へのSCP .etc
    - `desktop.md` にまとめる。
- 馬場
  - Batchに頭めぐらせ。
  - Python-Batch 味見 / Batch-PoC
    - DBもS3もない中。（馬場さんが徐々に必要になったら要求）
- 朝長
  - いろいろ考える。

### 1.1. 要件定義書 → 設計書作成 → Cfnテンプレート作成までの流れ

- 「Cfnテンプレート作成に必要なドキュメントを作ってください。」と、Copilotへお願いする。
  - Network設計書
  - 監視設計書（も作ってくれるのかな？）
    - .etc
- 要件定義書を磨いていくスタイル
  - [設計書/要件定義.md] を書き直してみる。（注意： [../要件定義書.md] ではない。）
  - その Pull Requestに対して、みんなが口出し（朝長、馬場、今井）  
  - `feature/docs` ブランチを鍛えていく。（＝つまり、Merge Requestを作りたいならこのブランチからさらにブランチを生やし、Requestする。）
    - [仮設計書作成 by to307ga · Pull Request #3 · nttdocomo-com/aws-templates-idhub](https://github.com/nttdocomo-com/aws-templates-idhub/pull/3) にコメントしていく。
- 10/21(火)に対面で協議
  - 隠れた要件がいろいろありそう。
    - 影武者
    - rbash
    - ......
- `feature/docs` ブランチをツリー構造を大幅に見直した。

## 2. 必要なモノ・武器

- 有料版Github Copilot
  - 準備中

## 4. PoC環境での検証

- 下回りは中川さん、完了。
- EC2 インスタンス x 3
- Jenkins, Web, 踏み台。今はJenkinsの「母艦」となるホストに着手。
  - Ansible Playbook を git cloneして ansibleが動くまで。
- 2025-10-22
  - Jenkins でのCI/CDが当初方針だった。
  - コンテナホストは、`Amazon Linux 2023`。そこにPodmanを入れたかった。
  - `Amazon Linux 2023` だと PodmanがPackageとして用意されていない。
  - 方針変更
    - Podman on EC2 は早々にあきらめる。 Fargate上にJenkinsを載せる。
    - Amazon Linuxになることで、Packageの変化・影響がどうあるのか？を洗い出す。

### 4.2. PoCでの検証項目を明確にしていきたいよね

- bprtech提供のCfnテンプレートは検証不要。
  - ただ、EC2に対しては、このTemplateは提供されていない。
  - なので EC2 のCfn Templateは自作する必要がある。
- 検証項目を思いつきで書いてみる。
  - MFA
    - 現状、Reverse Proxy 上で MFA のApache拡張モジュール
  - ......
- おいおい、検証項目を管理していこう。Backlogの出番、か？

### 4.3 IaC の守備範囲

- AS-IS
  - 現状、Puppet、Ansible、それぞれがどのような役割を担っているか？
- TO-BE
  - それがAWSへ行ってからは、Cfn、Ansibleがどう担うのか？

### 4.5 Sceptre Templateで受け付けるParameter

- 各Yamlで受け付けるParameterを文書化する。
  - Range
  - Default
  - 意味 (Description)

## 以降はアーカイブ

- 古い記事を押し出したもの。

### 1. Desktop

- デスクトップ環境を鍛える。 **→ Done**
  - セットアップ方法の「画一化」
  - `settings.json`, `projects.toml` といった共通設定ファイルを鍛える。 （朝長）
  - そこに至るまでには `uv`, `awscli` のインストールが完了していることが前提。
    - その手順をまとめる。 （伊藤）
  - `cp932`, SSL が、一生まとわりつく。Windowsとの相性、悪いかも。
    - SSLのWarningは ネイティブの aws-cli 実行時だけかも。
  - `dev` / `prod` の切り替え。
    - 事故りそう。
    - 運用フェーズでは、ローカル（VSCODE）からのCfn実行を避けるのがよいかも。
    - `prod` は、CI/CD的にGithub Actionで実行する、とか。

### 2. コミュニケーション手段

- チャットが見れない。
  - Slackだったり、別テナントのTeamsだったり。
  - へー社の外部ベンダーとのやり取り方法のスタンダードは「Google Workspace」らしい。（伊藤）
    - Google Workspaceはあくまで「文書共有ストレージ」。そのニーズは薄いかも。
    - 当座、Slackだけで乗り切ろう。
  - Slackを公式のチャットツールとしよう。
    - `#x_pjct_goosubsc_cns` チャネル

- 検証環境AWSアカウントの申請（今井 聡史） **→ (完了)**
  - サンドボックス的に、いじり倒せる環境
  - 「PJコード」が必要だが、先走ってAWSアカウントを申請してみる。
  - IAMユーザ、初回儀式
    - Passwd変更
    - MFA設定
      - access_key, secret_code 方式のアクセスだと、12時間ごとにMFA問われて面倒かも。
  - 古いIAM（Ex. `nttdocomo-iam-k5ito` ）は消します。（By 伊藤）

- 三鷹DCアカウント（SSH）
  - 藤本さん、中川さん、分
  - ED25519形式のキーペアファイルを作成いただく。
  - その公開鍵ファイルをSlackにて送付。

## 3. 「idhub とは？」を知りたい

- 10/17(金) 11:00～12:00
- 尾岸さん、朝長さん、CNSの新規2名。
- お客様目線。
と、
- システム構成
- 伊藤 → 尾岸さん、朝長さん、藤本さん、中川さん へレクチャ。
  - ありものの資料、挿絵を、Githubへ。

### 4.1. オンプレからAWS PoC環境へデータ転送したい

- 商用データのマイグレではない。
- VPNの位置づけは？
- PoC環境へデータ転送したい。From: 三鷹DC → To: AWS
- 結論
  - PoC段階では、三鷹 → S3 Putする。
![data-transfer](./images/poc-data-transfer.drawio.svg)
