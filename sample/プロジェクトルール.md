# プロジェクトルール

## 1. 実行コマンドルール

### 1.1 Python実行
- **必須**: `uv run` プレフィックスを使用
- **例**: 
  - ✅ `uv run python script.py`
  - ✅ `uv run sceptre launch stack-name`
  - ❌ `python script.py`
  - ❌ `sceptre launch stack-name`

### 1.2 Sceptreコマンドルール

#### 1.2.1 変更系コマンド（--yes必須）
- **対象コマンド**:
  - `create`
  - `launch`
  - `delete`
  - `update`
  - `execute`
- **ルール**: `--yes` フラグを必ず付与
- **例**:
  - ✅ `uv run sceptre launch stack-name --yes`
  - ✅ `uv run sceptre delete stack-name --yes`
  - ❌ `uv run sceptre launch stack-name`

#### 1.2.2 参照系コマンド（--yes禁止）
- **対象コマンド**:
  - `list`
  - `describe`
  - `get`
  - `status`
  - `validate`
- **ルール**: `--yes` フラグを付けない
- **例**:
  - ✅ `uv run sceptre list stacks`
  - ✅ `uv run sceptre describe stack-name`
  - ❌ `uv run sceptre list stacks --yes`

## 2. ファイル言語ルール

### 2.1 日本語使用禁止ファイル
- **対象ファイル**:
  - `.py` (Pythonスクリプト)
  - `.yaml` / `.yml` (YAML設定ファイル)
  - `.json` (JSON設定ファイル)
  - `.toml` (TOML設定ファイル)
  - `.tf` (Terraformファイル)
  - `.sh` (シェルスクリプト)
  - `.ps1` (PowerShellスクリプト)
- **ルール**: 英語のみ使用、日本語コメント禁止
- **例**:
  ```python
  # ✅ Good
  def create_dkim_certificate():
      """Create DKIM certificate for email authentication"""
      pass
  
  # ❌ Bad
  def create_dkim_certificate():
      """DKIM証明書を作成する"""
      pass
  ```

### 2.2 日本語使用可能ファイル
- **対象ファイル**:
  - `.md` (Markdownファイル)
  - `.txt` (テキストファイル)
- **ルール**: 日本語使用可能
- **例**:
  ```markdown
  # ✅ Good
  # DKIM証明書自動化設計書
  
  ## 概要
  このドキュメントは、AWS SESにおけるDKIM証明書の自動化について説明します。
  ```

## 3. 文字コードルール

### 3.1 デフォルト文字コード
- **文字コード**: UTF-8
- **改行コード**: LF (Unix形式)
- **BOM**: なし

### 3.2 適用ファイル
- すべてのテキストファイル
- 設定ファイル
- スクリプトファイル
- ドキュメントファイル

### 3.3 設定例
```yaml
# .editorconfig
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true
```

## 4. ファイル命名ルール

### 4.1 ファイル名
- **ルール**: 英語のみ、ハイフン区切り
- **例**:
  - ✅ `dkim-certificate-manager.py`
  - ✅ `sceptre-config.yaml`
  - ❌ `dkim証明書管理.py`
  - ❌ `sceptre_config.yaml`

### 4.2 ディレクトリ名
- **ルール**: 英語のみ、ハイフン区切り
- **例**:
  - ✅ `cloudformation-templates`
  - ✅ `lambda-functions`
  - ❌ `CloudFormationテンプレート`

## 5. コメントルール

### 5.1 Pythonファイル
```python
# ✅ Good
def create_dkim_certificate():
    """
    Create DKIM certificate for email authentication.
    
    Args:
        domain (str): Domain name for DKIM
        key_length (int): RSA key length (2048 or 4096)
    
    Returns:
        dict: DKIM certificate information
    """
    pass

# ❌ Bad
def create_dkim_certificate():
    """
    DKIM証明書を作成する
    
    Args:
        domain (str): DKIM用のドメイン名
        key_length (int): RSAキー長（2048または4096）
    
    Returns:
        dict: DKIM証明書情報
    """
    pass
```

### 5.2 YAMLファイル
```yaml
# ✅ Good
# CloudFormation template for DKIM certificate management
Resources:
  DKIMManagerFunction:
    Type: AWS::Lambda::Function
    Properties:
      # Function name for DKIM management
      FunctionName: dkim-manager
      # Runtime environment
      Runtime: python3.11

# ❌ Bad
# DKIM証明書管理用のCloudFormationテンプレート
Resources:
  DKIMManagerFunction:
    Type: AWS::Lambda::Function
    Properties:
      # DKIM管理用の関数名
      FunctionName: dkim-manager
      # ランタイム環境
      Runtime: python3.11
```

## 6. エラーハンドリングルール

### 6.1 エラーメッセージ
- **ルール**: 英語のみ
- **例**:
  ```python
  # ✅ Good
  raise ValueError("Invalid DKIM key length. Must be 2048 or 4096 bits")
  
  # ❌ Bad
  raise ValueError("無効なDKIMキー長です。2048または4096ビットである必要があります")
  ```

### 6.2 ログメッセージ
- **ルール**: 英語のみ
- **例**:
  ```python
  # ✅ Good
  logger.info("DKIM certificate created successfully")
  logger.error("Failed to create DKIM certificate: %s", str(e))
  
  # ❌ Bad
  logger.info("DKIM証明書が正常に作成されました")
  logger.error("DKIM証明書の作成に失敗しました: %s", str(e))
  ```

### 6.3 エラー修正時の対応ルール
- **禁止事項**: エラーが発生した際に、正しい値を調べる前に設定やコードを削除すること
- **必須対応**: エラーの原因を調査し、正しい値や構文を確認してから修正する
- **推奨手順**:
  1. エラーメッセージを詳細に分析
  2. 公式ドキュメントやMCPサーバで正しい構文を調査
  3. 正しい値に修正（削除は最後の手段）
  4. 削除が必要な場合は、その理由を明確に説明

- **例**:
  ```yaml
  # ❌ Bad - エラーが出たから削除
  # DeliveryOptions:
  #   TlsPolicy: Require  # エラーが出たので削除
  
  # ✅ Good - 正しい値を調査して修正
  DeliveryOptions:
    TlsPolicy: Optional  # 正しい値に修正
  ```

- **削除が許可される場合**:
  - 公式ドキュメントで非推奨または廃止が明記されている
  - プロジェクト要件で不要と判断された
  - 代替手段が明確に存在する

## 7. 設定ファイルルール

### 7.1 環境変数
- **ルール**: 英語のみ、大文字、アンダースコア区切り
- **例**:
  ```yaml
  # ✅ Good
  environment:
    DKIM_KEY_LENGTH: 2048
    SES_REGION: us-east-1
    NOTIFICATION_EMAIL: admin@example.com
  
  # ❌ Bad
  environment:
    DKIMキー長: 2048
    SESリージョン: us-east-1
    通知メール: admin@example.com
  ```

### 7.2 設定値
- **ルール**: 英語のみ
- **例**:
  ```yaml
  # ✅ Good
  stack_name: dkim-certificate-manager
  template_path: templates/dkim-manager.yaml
  region: us-east-1
  
  # ❌ Bad
  stack_name: dkim証明書管理
  template_path: templates/dkim管理.yaml
  region: us-east-1
  ```

## 8. テストルール

### 8.1 テストファイル名
- **ルール**: `test_` プレフィックス + 英語
- **例**:
  - ✅ `test_dkim_manager.py`
  - ✅ `test_certificate_generator.py`
  - ❌ `test_dkim管理.py`

### 8.2 テスト関数名
- **ルール**: `test_` プレフィックス + 英語
- **例**:
  ```python
  # ✅ Good
  def test_create_dkim_certificate():
      pass
  
  def test_validate_key_length():
      pass
  
  # ❌ Bad
  def test_dkim証明書作成():
      pass
  
  def test_キー長検証():
      pass
  ```

## 9. ドキュメントルール

### 9.1 README.md
- **ルール**: 日本語使用可能
- **内容**: プロジェクト概要、セットアップ手順、使用方法

### 9.2 技術ドキュメント
- **ルール**: 日本語使用可能
- **内容**: 設計書、仕様書、運用ガイド

### 9.3 APIドキュメント
- **ルール**: 英語推奨
- **内容**: 関数仕様、パラメータ説明

## 10. テンプレート作成ルール

### 10.1 基本ルール
- **分離原則**: テンプレートファイルとパラメータシートは必ず分けて作成
- **ディレクトリ分離**: 異なるディレクトリに配置
- **環境分離**: パラメータシートは環境毎のディレクトリに分ける

### 10.2 テンプレートファイル
- **配置場所**: `templates/`
- **ファイル形式**: `.yaml`, `.json`
- **命名規則**: kebab-case
- **例**:
  - `templates/dkim-manager.yaml`
  - `templates/kms-keys.yaml`
  - `templates/monitoring.yaml`

### 10.3 パラメータシート
- **配置場所**: `config/{environment}/`
- **ファイル形式**: `.yaml`
- **命名規則**: kebab-case + `-params` サフィックス
- **環境ディレクトリ**:
  - `config/development/`
  - `config/staging/`
  - `config/production/`
- **例**:
  - `config/development/dkim-manager-params.yaml`
  - `config/staging/dkim-manager-params.yaml`
  - `config/production/dkim-manager-params.yaml`

### 10.4 ディレクトリ構造例
```
templates/
├── dkim-manager.yaml
├── kms-keys.yaml
└── monitoring.yaml

config/
├── development/
│   ├── dkim-manager-params.yaml
│   ├── kms-keys-params.yaml
│   └── monitoring-params.yaml
├── staging/
│   ├── dkim-manager-params.yaml
│   ├── kms-keys-params.yaml
│   └── monitoring-params.yaml
└── production/
    ├── dkim-manager-params.yaml
    ├── kms-keys-params.yaml
    └── monitoring-params.yaml
```

### 10.5 作成プロセス
1. **テンプレートファイル作成**: `templates/` ディレクトリに配置
2. **パラメータファイル作成**: 環境毎の `config/{environment}/` ディレクトリに配置
3. **命名規則適用**: kebab-caseで統一
4. **ファイル分離**: テンプレートとパラメータを同じファイルに混在させない

## 11. バリデーション

### 11.1 自動チェック
- **ツール**: pre-commit hooks
- **チェック項目**:
  - 文字コード (UTF-8)
  - 改行コード (LF)
  - ファイル命名規則
  - コメント言語
  - テンプレート分離ルール

### 11.2 手動チェック
- **頻度**: プルリクエスト作成時
- **チェック項目**:
  - ルール準拠
  - 一貫性
  - 可読性
  - テンプレート分離の確認

## 12. 例外事項

### 12.1 例外が認められる場合
- 外部システムとの連携で日本語が必須
- 既存システムとの互換性維持
- 法的要件による日本語使用

### 12.2 例外申請手順
1. 例外理由の明記
2. 代替案の検討
3. チーム承認
4. ドキュメント化

---

**注意**: これらのルールは、プロジェクトの一貫性と保守性を保つために定められています。すべての開発者がこれらのルールに従うことを強く推奨します。
